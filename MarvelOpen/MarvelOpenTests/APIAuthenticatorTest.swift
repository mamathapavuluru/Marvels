//
//  APIAuthenticatorTest.swift
//  MarvelOpenTests
//
//  Created by mamatha on 5/16/22.
//

import XCTest

class APIAuthenticatorTest: XCTestCase {
    
    private var authenticationTest: MD5Authenticator!
    private var apiKeyData: APIKeyRetrieverData!

    override func setUpWithError() throws {
        // Put setup code here. This method is called before the invocation of each test method in the class.
        apiKeyData = APIKeyRetrieverData()
        authenticationTest = MD5Authenticator(keyData: apiKeyData)
        
    }

    override func tearDownWithError() throws {
        // Put teardown code here. This method is called after the invocation of each test method in the class.
    }

    func testMD5DigestAPIParams(){
        
        let timestamp: Double = 17
        let expectedTsParameter = String(Int(timestamp))
        let result = authenticationTest.authenticate(with: timestamp)
        XCTAssertEqual(result, ["hash": "c58da6dc13a64e8f9a7518ee30133fa1", "apikey": APIKeyRetrieverData.publicKeyData, "ts": expectedTsParameter])
    }
    
    func testMD5DigestForNoAPIKeysParams(){
        
        authenticationTest = MD5Authenticator(keyData: APIKeyRetrieverEmptyData())
        XCTAssertNil(authenticationTest.authenticate(with:17))
    }
    
}

private class APIKeyRetrieverData: APIKeysRetriver {

    static let publicKeyData = "1234567890"
    static let privateKeyData = "abcd"

    var publicKey: String? {
        Self.publicKeyData
    }
    var privateKey: String? {
        Self.privateKeyData
    }
}

private class APIKeyRetrieverEmptyData: APIKeysRetriver {

    var publicKey: String? {
        nil
    }
    var privateKey: String? {
        nil
    }
}

